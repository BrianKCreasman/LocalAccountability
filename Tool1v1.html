<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vibrant Accountability Weekly Tool | Walkthroughs + Check-Ins</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --black:#0b0b0c;
      --gray:#8a8f98;
      --gray2:#f2f3f5;
      --white:#ffffff;
      --gold:#dbd59b;

      --shadow: 0 18px 40px rgba(0,0,0,.14);
      --shadow2: 0 10px 22px rgba(0,0,0,.10);
      --radius: 22px;
      --radius2: 16px;

      --good:#1f7a6d;
      --warn:#b26a1d;
      --risk:#b42318;

      --line: rgba(0,0,0,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #ffffff 0%, #f4f5f7 55%, #ffffff 100%);
      color: var(--black);
    }

    /* Top bar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
      padding: 14px 16px;
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
    }
    .topbarInner{
      max-width: 1260px;
      margin: 0 auto;
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .titleBlock{display:flex; gap:12px; align-items:center;}
    .mark{
      width:44px;height:44px;border-radius:16px;
      background: radial-gradient(circle at 30% 30%, var(--gold), #fff 38%, #d9dbe0 85%);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: var(--shadow2);
    }
    .titleBlock h1{margin:0;font-size:15px;letter-spacing:.2px;}
    .titleBlock p{margin:2px 0 0 0;font-size:12px;color: var(--gray);}
    .actions{display:flex; gap:8px; flex-wrap:wrap;}
    button{
      border: 1px solid rgba(0,0,0,.14);
      background: var(--white);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 800;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0,0,0,.06);
    }
    button.primary{background: var(--black);color: var(--white);border-color: transparent;}
    button.gold{background: var(--gold);color: var(--black);border-color: rgba(0,0,0,.12);}
    button.danger{color: var(--risk);border-color: rgba(180,35,24,.25);}
    button:hover{filter:brightness(.98)}
    button:active{transform: translateY(1px)}

    /* Layout */
    .wrap{max-width:1260px;margin:18px auto;padding:0 14px 40px}
    .grid{display:grid;grid-template-columns: 1.25fr .75fr;gap:14px}
    @media(max-width:980px){.grid{grid-template-columns: 1fr}}

    /* Section boxes */
    .panel{
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,.10);
      overflow: hidden;
      background: var(--white);
    }
    .panelHeader{
      padding: 14px 16px;
      display:flex;
      align-items:flex-start;
      justify-content: space-between;
      gap:12px;
      border-bottom: 1px solid rgba(0,0,0,.08);
    }
    .panelHeader h2{margin:0;font-size:13px;letter-spacing:.2px;}
    .panelHeader .hint{margin-top:4px;font-size:12px;color: var(--gray);line-height:1.35;}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border-radius: 999px;
      padding: 7px 10px;
      border: 1px solid rgba(0,0,0,.12);
      background: var(--gray2);
      font-size: 12px;
      font-weight: 900;
      color: var(--black);
      white-space: nowrap;
    }
    .dot{width:9px;height:9px;border-radius:99px;background:var(--gold);display:inline-block}
    .panelBody{padding: 14px 16px}

    /* Color themes */
    .theme-black .panelHeader{background: linear-gradient(90deg, rgba(0,0,0,.92), rgba(0,0,0,.86)); color:#fff}
    .theme-black .panelHeader .hint{color: rgba(255,255,255,.78)}
    .theme-gold  .panelHeader{background: linear-gradient(90deg, rgba(219,213,155,.95), rgba(219,213,155,.75)); color:#000}
    .theme-gray  .panelHeader{background: linear-gradient(90deg, #f2f3f5, #ffffff); color:#000}
    .theme-white .panelHeader{background: linear-gradient(90deg, #ffffff, #fbfbfc); color:#000}

    /* Inner blocks */
    .blocks{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .block{
      border-radius: var(--radius2);
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
      background: var(--white);
      padding: 12px;
      min-height: 92px;
    }
    .block.gold{background: linear-gradient(180deg, rgba(219,213,155,.35), rgba(255,255,255,.92))}
    .block.gray{background: linear-gradient(180deg, rgba(242,243,245,.95), rgba(255,255,255,.92))}
    .block.black{background: linear-gradient(180deg, rgba(0,0,0,.92), rgba(20,20,22,.96)); color:#fff}
    .block.black label{color: rgba(255,255,255,.78)}
    .block.black .q{color: rgba(255,255,255,.88)}
    .block.black input,.block.black select,.block.black textarea{
      background: rgba(255,255,255,.92);
      color: #000;
    }

    .span-12{grid-column: span 12}
    .span-8{grid-column: span 8}
    .span-6{grid-column: span 6}
    .span-4{grid-column: span 4}
    .span-3{grid-column: span 3}
    @media(max-width:900px){
      .span-8,.span-6,.span-4,.span-3{grid-column: span 12}
    }

    .k{font-size:12px;font-weight:900;letter-spacing:.2px;margin-bottom:6px}
    .q{font-size:12px;color:var(--gray);line-height:1.35;margin:0 0 10px 0}

    label{display:block;font-size:12px;color:var(--gray);margin:0 0 6px 2px;font-weight:900}
    input[type="text"], input[type="date"], input[type="number"], select, textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.14);
      padding: 10px 10px;
      font-size: 13px;
      outline:none;
      background: var(--white);
    }
    textarea{min-height: 92px; resize: vertical}
    .small{min-height: 70px}

    /* checkboxes */
    .checks{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .check{
      grid-column: span 6;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.12);
      background: #fff;
      box-shadow: 0 12px 20px rgba(0,0,0,.08);
      padding: 10px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .check b{display:block;font-size:12px}
    .check small{display:block;font-size:11px;color:var(--gray);line-height:1.25;margin-top:2px}
    @media(max-width:900px){ .check{grid-column: span 12;} }

    /* ratings */
    .ratingRow{display:flex; gap:8px; flex-wrap:wrap}
    .rateBtn{
      width:42px;height:42px;border-radius: 14px;
      border: 1px solid rgba(0,0,0,.14);
      background:#fff;
      box-shadow: 0 10px 18px rgba(0,0,0,.07);
      display:flex; align-items:center; justify-content:center;
      font-weight:1000; cursor:pointer;
      user-select:none;
    }
    .rateBtn.active{
      background: var(--gold);
      border-color: rgba(0,0,0,.18);
      box-shadow: 0 16px 26px rgba(0,0,0,.12);
    }

    .pillTag{
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(0,0,0,.12);
      background: #fff;
      font-weight: 900;
      display:inline-block;
      font-size:11px;
      margin-right:6px;
      margin-top:6px;
    }
    .pillTag.good{color: #1f7a6d}
    .pillTag.warn{color: #b26a1d}
    .pillTag.risk{color: #b42318}

    /* focus selector tiles */
    .focusTiles{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 10px;
      margin-top:10px;
    }
    .tile{
      grid-column: span 6;
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.12);
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
      background: linear-gradient(180deg, rgba(242,243,245,.95), rgba(255,255,255,.95));
      padding: 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .tile.gold{background: linear-gradient(180deg, rgba(219,213,155,.35), rgba(255,255,255,.95))}
    .tile b{display:block;font-size:12px}
    .tile small{display:block;font-size:11px;color:var(--gray);line-height:1.25;margin-top:3px}
    .tile input{margin-top:2px}
    @media(max-width:900px){ .tile{grid-column: span 12;} }

    /* details / accordion */
    details{
      border-radius: 18px;
      border: 1px solid rgba(0,0,0,.12);
      background: #fff;
      box-shadow: 0 12px 22px rgba(0,0,0,.08);
      padding: 10px 12px;
    }
    details + details{margin-top:10px}
    summary{
      cursor:pointer;
      font-weight:1000;
      font-size:12px;
      list-style:none;
      outline:none;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:10px;
    }
    summary::-webkit-details-marker{display:none}
    .sumHint{font-size:11px;color:var(--gray);font-weight:900}
    .detailBody{margin-top:10px;font-size:12px;color: var(--black);line-height:1.4}
    .detailBody .muted{color:var(--gray)}
    ul{margin:8px 0 0 18px; padding:0}
    li{margin:4px 0}

    /* table */
    table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:18px;border:1px solid rgba(0,0,0,.10);box-shadow:0 14px 26px rgba(0,0,0,.10)}
    th,td{padding:10px 10px;font-size:12px;border-bottom:1px solid rgba(0,0,0,.08);vertical-align:top;background:#fff}
    th{background: linear-gradient(90deg, rgba(219,213,155,.35), rgba(255,255,255,.96));text-align:left;font-weight:1000}
    tr:last-child td{border-bottom:none}
    .clickRow{cursor:pointer}
    .muted{color:var(--gray)}
    .foot{font-size:11px;color:var(--gray);margin-top:10px;line-height:1.35}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbarInner">
      <div class="titleBlock">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h1>Vibrant Accountability Weekly Tool</h1>
          <p>Walkthroughs and weekly check-ins. Tracks growth and quality while reinforcing the vision.</p>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="saveBtn">Save Entry</button>
        <button class="gold" id="summaryBtn">Monday Summary</button>
        <button id="exportCsvBtn">Export CSV</button>
        <button id="exportJsonBtn">Export JSON</button>
        <button class="danger" id="clearBtn">Clear All</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">
      <!-- LEFT: ENTRY -->
      <div class="panel theme-black">
        <div class="panelHeader">
          <div>
            <h2>Entry Capture</h2>
            <div class="hint">Keep it simple. Tell the truth. Name owners. Bring proof next Monday.</div>
          </div>
          <div class="chip"><span class="dot"></span><span id="entryCountChip">0 entries</span></div>
        </div>

        <div class="panelBody">
          <!-- SYSTEM TIGHTENING NARRATIVE (your requested text) -->
          <div class="block gold span-12" style="margin-bottom:12px;">
            <div class="k">System Tightening Moment</div>
            <p class="q" style="color:var(--black); margin-bottom:8px;">
              <b>This is a strong moment to pause and tighten the system.</b> You already have the right architecture.
              What you are really doing here is making the invisible visible. Daily practice, clear signals,
              and credible evidence all lining up.
            </p>
            <p class="q" style="margin-bottom:0;">
              This tool intentionally separates <b>what can be observed daily</b> from <b>what can be validated through artifacts</b>.
              That distinction is where most systems lose clarity.
            </p>
          </div>

          <!-- Identity + cadence -->
          <div class="blocks">
            <div class="block gold span-6">
              <div class="k">Identity</div>
              <p class="q">Where did you go, who did you learn with, and what did you see?</p>
              <label for="entryDate">Date</label>
              <input type="date" id="entryDate"/>
              <div style="height:8px"></div>
              <label for="entryType">Entry type</label>
              <select id="entryType">
                <option value="Weekly Check-In">Weekly Check-In</option>
                <option value="Walkthrough">Walkthrough</option>
                <option value="Leadership Round">Leadership Round</option>
                <option value="Data Review">Data Review</option>
                <option value="Support Visit">Support Visit</option>
              </select>
            </div>

            <div class="block gray span-6">
              <div class="k">Context</div>
              <p class="q">What are you trying to improve this week? What is the next inch?</p>
              <label for="school">School</label>
              <select id="school">
                <option value="">Select...</option>
                <option>District Office</option>
                <option>Elementary School</option>
                <option>Middle School</option>
                <option>High School</option>
                <option>Other</option>
              </select>
              <div style="height:8px"></div>
              <label for="who">Primary contact</label>
              <select id="who">
                <option>Principal</option>
                <option>Assistant Principal</option>
                <option>Instructional Coach</option>
                <option>Teacher Team</option>
                <option>Student Group</option>
                <option>Other</option>
              </select>
            </div>

            <!-- Mulally overlay -->
            <div class="block black span-12">
              <div class="k">Vibrant Accountability Overlay</div>
              <p class="q">If we read this in 60 seconds, would we know the plan, the truth, and the next proof point?</p>

              <div class="blocks" style="gap:10px">
                <div class="block gold span-4" style="box-shadow:none">
                  <label for="overallStatus">Overall status (R/Y/G)</label>
                  <select id="overallStatus">
                    <option value="Green">Green (On plan)</option>
                    <option value="Yellow">Yellow (Uneven, recovery in motion)</option>
                    <option value="Red">Red (Off plan, needs help)</option>
                  </select>
                  <div>
                    <span class="pillTag good">Green</span>
                    <span class="pillTag warn">Yellow</span>
                    <span class="pillTag risk">Red</span>
                  </div>
                </div>

                <div class="block gray span-8" style="box-shadow:none">
                  <label for="weekTheme">Week theme (optional)</label>
                  <input type="text" id="weekTheme" placeholder="Example: Tighten CFUs. Increase on-track % for Priority Standard X."/>
                  <div style="height:10px"></div>
                  <label for="whatChanged">What changed since last week?</label>
                  <textarea id="whatChanged" class="small" placeholder="Numbers or observable differences. What moved? What did you see?"></textarea>
                </div>

                <div class="block gray span-6" style="box-shadow:none">
                  <label for="topIssues">Top issue (root cause, one sentence)</label>
                  <textarea id="topIssues" class="small" placeholder="What is the constraint holding the system back?"></textarea>
                </div>
                <div class="block gray span-6" style="box-shadow:none">
                  <label for="helpNeeded">Help needed (who removes the barrier?)</label>
                  <textarea id="helpNeeded" class="small" placeholder="Curriculum, Student Services, HR, Transportation, Tech, Ops, etc."></textarea>
                </div>

                <div class="block gold span-6" style="box-shadow:none">
                  <label for="owner">Owner (single accountable person)</label>
                  <input type="text" id="owner" placeholder="Name"/>
                </div>
                <div class="block gold span-6" style="box-shadow:none">
                  <label for="dueDate">Due date (next check)</label>
                  <input type="date" id="dueDate"/>
                </div>
              </div>
            </div>
          </div>

          <!-- Focus area selection -->
          <div style="height:14px"></div>
          <div class="panel theme-gold" style="box-shadow: var(--shadow); border-radius: var(--radius);">
            <div class="panelHeader">
              <div>
                <h2>Weekly Focus Areas</h2>
                <div class="hint">Choose 1–2 focus areas. The tool shows only the questions and evidence for what you select.</div>
              </div>
              <div class="chip"><span class="dot"></span><span>Daily vs Evidence</span></div>
            </div>
            <div class="panelBody">
              <div class="focusTiles" id="focusTiles"></div>
              <div class="blocks" style="margin-top:12px">
                <div class="block gray span-6">
                  <div class="k">Wins (Top 3)</div>
                  <p class="q">What should we protect because it is working?</p>
                  <textarea id="generalGlows" class="small" placeholder="Short, specific, evidence-backed wins."></textarea>
                </div>
                <div class="block gray span-6">
                  <div class="k">Gaps (Top 3)</div>
                  <p class="q">What is the next inch? What is drifting off plan?</p>
                  <textarea id="generalGrows" class="small" placeholder="Short, specific problems we will solve."></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Focus modules -->
          <div style="height:14px"></div>
          <div class="panel theme-white">
            <div class="panelHeader">
              <div>
                <h2>Focus Modules</h2>
                <div class="hint">Each module separates daily observable practice from evidence that can be validated through artifacts.</div>
              </div>
              <div class="chip"><span class="dot"></span><span>Coherence</span></div>
            </div>
            <div class="panelBody">
              <div id="modulesHost"></div>
            </div>
          </div>

          <!-- Final system check (your requested coherence test) -->
          <div style="height:14px"></div>
          <div class="panel theme-gray">
            <div class="panelHeader">
              <div>
                <h2>Final System Check</h2>
                <div class="hint">If any one component operates in isolation, the system weakens. When they align, daily practice and evidence tell the same story.</div>
              </div>
              <div class="chip"><span class="dot"></span><span>Coherence Test</span></div>
            </div>
            <div class="panelBody">
              <div class="blocks">
                <div class="block gold span-12">
                  <div class="k">Coherence test that matters most</div>
                  <ul>
                    <li><b>Vibrant Learning</b> defines the experience</li>
                    <li><b>Priority Standards</b> define the focus</li>
                    <li><b>BIM</b> defines the daily practice</li>
                    <li><b>BPAs</b> define the demonstration of learning</li>
                    <li><b>BPIs</b> define the learner outcomes</li>
                    <li><b>Compelling Evidence and SRG</b> define credibility and trust</li>
                  </ul>
                  <div class="foot">Use this as a quick leadership check: Are we aligning the daily with the durable?</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Next Moves -->
          <div style="height:14px"></div>
          <div class="panel theme-gray">
            <div class="panelHeader">
              <div>
                <h2>Concrete Next Moves</h2>
                <div class="hint">Who will do what by when, and what proof will we bring next Monday?</div>
              </div>
              <div class="chip"><span class="dot"></span><span>Follow-through</span></div>
            </div>
            <div class="panelBody">
              <div class="blocks">
                <div class="block gold span-6">
                  <div class="k">Next moves (1–3)</div>
                  <p class="q">Name actions that change the learner experience, not just paperwork.</p>
                  <textarea id="nextMoves" placeholder="Action 1 (owner, due). Action 2 (owner, due). Action 3 (owner, due)."></textarea>
                </div>
                <div class="block gold span-6">
                  <div class="k">Proof point for next Monday</div>
                  <p class="q">Exactly what artifact and what number will you show next week?</p>
                  <textarea id="proofNextWeek" placeholder="Example: 3 labeled student work samples + on-track % movement for Priority Standard X."></textarea>
                </div>
              </div>
              <div class="foot">Mulally test: If there is no proof point, the plan is not real yet.</div>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT: DASHBOARD -->
      <div class="panel theme-gold">
        <div class="panelHeader">
          <div>
            <h2>Trend Dashboard</h2>
            <div class="hint">Uses saved entries in this browser. Filter by school. Track patterns over time.</div>
          </div>
          <div class="chip"><span class="dot"></span><span id="entryCount">0</span></div>
        </div>

        <div class="panelBody">
          <div class="blocks">
            <div class="block gray span-6">
              <div class="k">Filter</div>
              <p class="q">Keep the conversation focused.</p>
              <label for="filterSchool">School</label>
              <select id="filterSchool">
                <option value="ALL">All Schools</option>
              </select>
            </div>

            <div class="block gray span-6">
              <div class="k">Signal</div>
              <p class="q">Chart one numeric signal from the modules.</p>
              <label for="metricPick">Numeric signal</label>
              <select id="metricPick"></select>
            </div>

            <div class="block span-12">
              <div class="k">Overall status trend</div>
              <p class="q">Red=1, Yellow=2, Green=3. The goal is honest visibility and steady improvement.</p>
              <canvas id="statusChart" height="150"></canvas>
            </div>

            <div class="block span-12">
              <div class="k">Numeric signal trend</div>
              <p class="q">Only chart what you actually track. Empty values stay empty.</p>
              <canvas id="metricChart" height="150"></canvas>
            </div>

            <div class="block span-12">
              <div class="k">Most recent entries</div>
              <p class="q">Click a row to load it into the left panel for updating.</p>
              <div style="overflow:auto; max-height: 420px;">
                <table id="entriesTable">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>School</th>
                      <th>Status</th>
                      <th>Focus</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div class="foot">Export CSV/JSON to move this into Google Sheets, a dashboard, or a Monday meeting packet.</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
  // ---------------- STORAGE ----------------
  const STORAGE_KEY = "vibrant_accountability_weekly_tool_v3";

  // ---------------- DEFINITIONS ----------------
  // Includes your 6 areas of focus, and explicitly separates daily observable vs validated evidence.
  const FOCUS = [
    {
      key: "Vibrant Learning",
      theme: "gold",
      title: "Vibrant Learning",
      tagline: "The learner experience. The why behind everything else.",
      majorComponents: [
        "Student agency and voice",
        "Purposeful, contextual, real-world learning",
        "Interdisciplinary connections",
        "Writing Across the Content",
        "Engagement, relevance, and ownership"
      ],
      keyIndicators: [
        "Students understand the purpose of the learning",
        "Students make choices in process, product, or pathway",
        "Learning connects to real-world contexts or problems",
        "Students communicate thinking through writing, speaking, or creating",
        "Students reflect on learning and growth"
      ],
      observedDaily: [
        "Students explaining why they are learning something",
        "Multiple pathways or products visible in the room",
        "Students asking questions, not just answering them",
        "Writing, discussion, or creation embedded in lessons",
        "Students referencing real-world examples or applications"
      ],
      validatedEvidence: [
        "Student reflections tied to learning goals",
        "Interdisciplinary task descriptions or unit plans",
        "Writing samples across content areas",
        "Project briefs showing real-world context",
        "Student-created artifacts demonstrating choice and ownership"
      ],
      pushQuestion: "If a visitor walked into a classroom for ten minutes, would they know who owns the learning? The teacher or the students?",
      subareas: [
        { key:"Interdisciplinary Learning", desc:"Students connect learning across subjects to create, solve, or explain something meaningful." },
        { key:"Writing Across the Content", desc:"Writing is used to think, explain, argue, and create in all subjects." },
        { key:"Real-world Learning", desc:"Tasks have authentic purpose, audience, constraints, and application." },
        { key:"Student Agency", desc:"Students have voice, choice, ownership, and can articulate goals and growth." }
      ],
      lookFors: [
        {id:"student_why", title:"Students can explain the why", desc:"Purpose and relevance are understood by learners."},
        {id:"choice_real", title:"Choice is meaningful", desc:"Product, process, topic, audience, or tools are student-influenced."},
        {id:"thinking_visible", title:"Thinking is visible", desc:"Reasoning, drafts, revisions, reflection, and problem-solving steps appear."},
        {id:"audience", title:"Authentic audience/purpose", desc:"Work is designed to matter beyond the classroom."},
        {id:"integrated", title:"Integrated learning", desc:"Two or more disciplines are connected in a real way."}
      ],
      ratings: [
        {key:"relevance", label:"Relevance", hint:"Learners see value and purpose."},
        {key:"agency", label:"Agency", hint:"Students make decisions and own the work."},
        {key:"transfer", label:"Thinking/Transfer", hint:"Work requires reasoning and application."},
        {key:"evidence", label:"Evidence Quality", hint:"Artifacts prove learning, not just completion."}
      ],
      signals: [
        {key:"artifacts_added", label:"# new artifacts captured this week"},
        {key:"student_voice_samples", label:"# student voice proof points"},
        {key:"real_world_tasks", label:"# authentic tasks observed (est.)"}
      ],
      evidenceRule: "Attach 1 artifact link (work sample/photo) plus 1 student quote that proves relevance or agency."
    },

    {
      key: "Priority Standards and Proficiency Scales",
      theme: "gray",
      title: "Priority Standards and Proficiency Scales",
      tagline: "Clarity about what matters most.",
      majorComponents: [
        "Identified priority standards",
        "Student-friendly learning targets",
        "Proficiency scales (1–4 or continuum-based)",
        "Alignment between instruction, assessment, and reporting"
      ],
      keyIndicators: [
        "Focus on depth over coverage",
        "Clear descriptions of what proficiency looks like",
        "Consistent language across classrooms and schools",
        "Students tracking their own progress"
      ],
      observedDaily: [
        "Learning targets posted and referenced",
        "Teachers using proficiency language during instruction",
        "Students discussing where they are on a scale",
        "Feedback aligned to specific standards"
      ],
      validatedEvidence: [
        "Documented priority standards by grade/course",
        "Proficiency scales with clear descriptors",
        "Student self-assessments",
        "Standards-aligned formative assessments",
        "Lesson plans intentionally aligned to priority standards"
      ],
      pushQuestion: "Are proficiency scales tools for learning or just compliance documents?",
      subareas: [
        { key:"Priority Standard Clarity", desc:"Staff can name priority outcomes and unpack what they mean." },
        { key:"Scale Quality and Use", desc:"Scales are accurate and actively used to plan and give feedback." },
        { key:"Monitoring and Response", desc:"Teams track movement and adjust teaching based on evidence." }
      ],
      lookFors: [
        {id:"target_explicit", title:"Priority target is explicit", desc:"Priority standard is named and unpacked."},
        {id:"scale_used", title:"Scale language is used", desc:"Teacher and students reference what levels look like."},
        {id:"task_match", title:"Tasks match intent", desc:"Work aligns to the level of thinking expected."},
        {id:"on_off_track", title:"On/off-track picture is clear", desc:"Teams can name who is on track and who is not."},
        {id:"response", title:"Response is evidence-based", desc:"Reteach/enrich decisions match what evidence shows."}
      ],
      ratings: [
        {key:"clarity", label:"Clarity", hint:"Priority outcomes are consistently understood."},
        {key:"scale_use", label:"Scale Use", hint:"Scales guide instruction and feedback."},
        {key:"alignment", label:"Alignment", hint:"Tasks and evidence match outcomes."},
        {key:"response", label:"Response", hint:"Teams respond quickly and specifically."}
      ],
      signals: [
        {key:"pct_on_track", label:"% students on track (priority outcome)"},
        {key:"scale_used_pct", label:"% classrooms using scale language (est.)"},
        {key:"stuck_point_count", label:"# students stuck at a level (est.)"}
      ],
      evidenceRule: "Attach the scale used this week and one labeled student work sample tied to a level."
    },

    {
      key: "BRIDGE Instructional Model (BIM): The Workshop Model",
      theme: "gold",
      title: "BRIDGE Instructional Model (BIM): The Workshop Model",
      tagline: "How learning is designed and facilitated.",
      majorComponents: [
        "Mini-lesson",
        "Guided practice or workshop time",
        "Independent or collaborative work",
        "Conferencing and feedback",
        "Reflection and closure"
      ],
      keyIndicators: [
        "Gradual release of responsibility",
        "Differentiation based on student need",
        "Active student work time",
        "Feedback driving improvement"
      ],
      observedDaily: [
        "Short, focused instruction followed by student work",
        "Teacher conferring with individuals or small groups",
        "Students engaged in purposeful tasks",
        "Flexible grouping",
        "Clear routines and transitions"
      ],
      validatedEvidence: [
        "Lesson plans aligned to the workshop structure",
        "Conferencing notes or feedback logs",
        "Student work in progress",
        "Differentiation plans or grouping strategies",
        "Reflection prompts used consistently"
      ],
      pushQuestion: "Is most class time spent watching learning or doing learning?",
      subareas: [
        { key:"Mini-lesson Precision", desc:"Clear teaching point, modeling, and purpose." },
        { key:"Work Time Quality", desc:"Conferencing, small groups, differentiation, engagement." },
        { key:"Reflection, Closure, and CFUs", desc:"Checks for understanding, reflection, and next steps." }
      ],
      lookFors: [
        {id:"teach_point", title:"Teaching point is tight", desc:"One clear focus, not a list."},
        {id:"modeling", title:"Modeling includes thinking", desc:"Reasoning is shown, not just answers."},
        {id:"work_time", title:"Students do the heavy lifting", desc:"High cognitive engagement during work time."},
        {id:"conferencing", title:"Conferencing is purposeful", desc:"Teacher uses evidence to coach and adjust."},
        {id:"cfu", title:"CFUs drive adjustments", desc:"Checks lead to instructional moves."},
        {id:"closure", title:"Closure consolidates learning", desc:"Students reflect and set next steps."}
      ],
      ratings: [
        {key:"clarity", label:"Clarity", hint:"Targets and teaching point are understood."},
        {key:"task_quality", label:"Task Quality", hint:"Work requires thinking, not just completion."},
        {key:"responsive", label:"Responsive Teaching", hint:"Instruction adjusts based on evidence."},
        {key:"culture", label:"Learning Culture", hint:"Routines and tone support learning."}
      ],
      signals: [
        {key:"walkthroughs_count", label:"# walkthroughs completed this week"},
        {key:"cfu_avg", label:"avg CFUs per class (est.)"},
        {key:"pct_meeting_core", label:"% classrooms meeting core expectations (est.)"}
      ],
      evidenceRule: "Attach one CFU sample (exit ticket/photo) and one conferring or small-group plan note."
    },

    {
      key: "BRIDGE Performance Assessments (BPAs)",
      theme: "gray",
      title: "BRIDGE Performance Assessments (BPAs)",
      tagline: "Where students demonstrate learning in meaningful ways.",
      majorComponents: [
        "Performance-based tasks",
        "Real-world or authentic scenarios",
        "Interdisciplinary connections",
        "Durable skills embedded by design",
        "Reflection on learning and process"
      ],
      keyIndicators: [
        "Students applying knowledge, not recalling it",
        "Multiple ways to demonstrate mastery",
        "Clear criteria for success",
        "Student choice and creativity"
      ],
      observedDaily: [
        "Students working on extended tasks or projects",
        "Problem-solving, collaboration, and communication",
        "Teachers coaching rather than directing",
        "Use of rubrics or success criteria during work time"
      ],
      validatedEvidence: [
        "BPA task descriptions and prompts",
        "Rubrics aligned to standards and durable skills",
        "Student products and presentations",
        "Reflection responses",
        "Feedback cycles tied to improvement"
      ],
      pushQuestion: "Would this assessment exist outside of school and still make sense?",
      subareas: [
        { key:"Assessment Quality", desc:"Aligned, rigorous, authentic, worth doing." },
        { key:"Implementation", desc:"Students create, revise, present, and reflect." },
        { key:"Calibration and Use", desc:"Scoring is consistent and results change instruction." }
      ],
      lookFors: [
        {id:"prompt", title:"Prompt is aligned and authentic", desc:"Task requires application and demonstrates mastery."},
        {id:"rubric", title:"Rubric is usable", desc:"Students can use it to improve quality."},
        {id:"process", title:"Process supports quality", desc:"Feedback and revision are built in."},
        {id:"reflection", title:"Reflection is real", desc:"Students explain growth and next steps."},
        {id:"calibration", title:"Calibration occurs", desc:"Adults score together using anchors."}
      ],
      ratings: [
        {key:"quality", label:"BPA Quality", hint:"Task and rubric create credible evidence."},
        {key:"implementation", label:"Implementation", hint:"Students are supported to produce quality."},
        {key:"calibration", label:"Calibration", hint:"Scoring is consistent and anchored."},
        {key:"use", label:"Use of Results", hint:"Results drive next instructional moves."}
      ],
      signals: [
        {key:"bpa_active_count", label:"# BPAs active this week"},
        {key:"bpa_completion_pct", label:"% completion (cycle)"},
        {key:"calibration_sessions", label:"# calibration sessions completed"}
      ],
      evidenceRule: "Attach BPA prompt + rubric + one student product (draft/final) + reflection note."
    },

    {
      key: "BRIDGE Performance Indicators (BPIs): Portrait of a Learner",
      theme: "gold",
      title: "BRIDGE Performance Indicators (BPIs): Portrait of a Learner",
      tagline: "Who the student is becoming.",
      majorComponents: [
        "Communication",
        "Problem-solving",
        "Collaboration",
        "Creativity and innovation",
        "Growth and learning resilience"
      ],
      keyIndicators: [
        "Students demonstrating skills across contexts",
        "Skills embedded in academic work",
        "Language of the Portrait used consistently",
        "Students reflecting on skill development"
      ],
      observedDaily: [
        "Students working together intentionally",
        "Presentations, discussions, and explanations",
        "Students revising work based on feedback",
        "Teachers naming durable skills during instruction"
      ],
      validatedEvidence: [
        "BPI websites or digital portfolios",
        "Reflections tied to specific indicators",
        "Performance rubrics aligned to Portrait skills",
        "Artifacts collected across time and content",
        "Student-led conferences or presentations"
      ],
      pushQuestion: "Are BPIs add-ons, or are they visible inside core learning?",
      subareas: [
        { key:"Communication", desc:"Students explain, present, write, and communicate thinking across contexts." },
        { key:"Problem-Solving", desc:"Students identify constraints, test solutions, and reflect on results." },
        { key:"Collaboration / Innovation / Resilience", desc:"Students work with others, create, iterate, and persist through difficulty." }
      ],
      lookFors: [
        {id:"named_skills", title:"Durable skills are named", desc:"Adults and students use shared Portrait language."},
        {id:"embedded", title:"Skills are embedded", desc:"Skills show up in core learning, not side activities."},
        {id:"feedback", title:"Feedback drives growth", desc:"Students revise and improve based on feedback."},
        {id:"reflection", title:"Reflection is tied to skills", desc:"Students can describe growth in a specific indicator."},
        {id:"portfolio", title:"Evidence is curated", desc:"Students capture artifacts across time and content."}
      ],
      ratings: [
        {key:"visibility", label:"Visibility", hint:"Skills are visible in daily learning."},
        {key:"language", label:"Shared Language", hint:"Portrait terms are used consistently."},
        {key:"student_ownership", label:"Student Ownership", hint:"Students curate and explain their evidence."},
        {key:"quality", label:"Evidence Quality", hint:"Artifacts credibly demonstrate durable skills."}
      ],
      signals: [
        {key:"portfolio_updates", label:"# portfolio/BPI website updates this week"},
        {key:"student_led_moments", label:"# student-led moments (conferences/presentations)"},
        {key:"revision_cycles", label:"# revision cycles observed (est.)"}
      ],
      evidenceRule: "Attach a portfolio link and one reflection tied to a specific Portrait indicator."
    },

    {
      key: "Compelling Evidence and Standards-Referenced Grading (SRG)",
      theme: "gray",
      title: "Compelling Evidence and Standards-Referenced Grading (SRG)",
      tagline: "How learning is documented, validated, and communicated.",
      majorComponents: [
        "Multiple measures of evidence",
        "Standards-referenced reporting",
        "Separation of product, process, and progress",
        "Transparency for students and families"
      ],
      keyIndicators: [
        "Grades reflect mastery of standards",
        "Evidence gathered over time",
        "Clear connection between evidence and reporting",
        "Students understand how grades are determined"
      ],
      observedDaily: [
        "Teachers referencing evidence during feedback",
        "Students revising work to improve mastery",
        "Conversations focused on learning, not points",
        "Use of formative evidence to guide instruction"
      ],
      validatedEvidence: [
        "Gradebooks aligned to standards",
        "Collections of student evidence over time",
        "Documentation of reassessment or revision",
        "Clear reporting tools for families",
        "Alignment between BPAs, BPIs, and grades"
      ],
      pushQuestion: "Does the grade tell the story of learning or just the final snapshot?",
      subareas: [
        { key:"Evidence Rules", desc:"Shared expectations for what counts and what does not." },
        { key:"Grade Integrity", desc:"Grades reflect standards performance, not averages or compliance." },
        { key:"Transparency and Understanding", desc:"Students and families understand how grades are determined." }
      ],
      lookFors: [
        {id:"evidence_std", title:"Evidence is standards-based", desc:"Artifacts tie to standards, not points."},
        {id:"recency", title:"Recency matters", desc:"Recent evidence is prioritized over old averages."},
        {id:"separate", title:"Behaviors are separated", desc:"Work habits are not mixed into mastery."},
        {id:"reassess", title:"Reassess/revise exists", desc:"Students can improve with new evidence."},
        {id:"student", title:"Student can explain level", desc:"Learners know where they are and what to do next."}
      ],
      ratings: [
        {key:"integrity", label:"Grade Integrity", hint:"Grades match mastery evidence."},
        {key:"consistency", label:"Consistency", hint:"Expectations are consistent across classrooms."},
        {key:"clarity", label:"Student Clarity", hint:"Students understand levels and next steps."},
        {key:"evidence", label:"Evidence Quality", hint:"Evidence is compelling and current."}
      ],
      signals: [
        {key:"evidence_audits", label:"# evidence spot-checks this week"},
        {key:"srg_alignment_pct", label:"% gradebook alignment (est.)"},
        {key:"reassessment_count", label:"# reassessments/revisions completed"}
      ],
      evidenceRule: "Attach a gradebook slice and one student evidence trail showing growth over time."
    }
  ];

  // ---------------- STATE ----------------
  let entries = [];
  let statusChart, metricChart;

  // ---------------- UTIL ----------------
  const $ = (id) => document.getElementById(id);
  const pad = (n)=> String(n).padStart(2,"0");
  function todayISO(){
    const d = new Date();
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  }
  function safeId(s){ return String(s).replace(/[^a-zA-Z0-9_]+/g, "_"); }

  function loadEntries(){
    try{ entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); if(!Array.isArray(entries)) entries=[]; }
    catch(e){ entries=[]; }
  }
  function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }
  function newId(){ return "e_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16); }

  function tagHTML(status){
    if(status==="Green") return `<span class="pillTag good">Green</span>`;
    if(status==="Yellow") return `<span class="pillTag warn">Yellow</span>`;
    return `<span class="pillTag risk">Red</span>`;
  }

  // ---------------- FOCUS TILES ----------------
  function renderFocusTiles(){
    const host = $("focusTiles");
    host.innerHTML = "";
    FOCUS.forEach(f=>{
      const div = document.createElement("div");
      div.className = `tile ${f.theme==="gold" ? "gold" : ""}`;
      div.innerHTML = `
        <input type="checkbox" id="focus_${safeId(f.key)}" data-focus="${f.key}">
        <div>
          <b>${f.title}</b>
          <small>${f.tagline}</small>
        </div>
      `;
      host.appendChild(div);
      div.querySelector("input").addEventListener("change", renderModules);
    });
  }
  function selectedFocusKeys(){
    return FOCUS
      .filter(f => document.getElementById(`focus_${safeId(f.key)}`)?.checked)
      .map(f => f.key);
  }

  // ---------------- MODULES ----------------
  function listHTML(arr){ return `<ul>${arr.map(x=>`<li>${x}</li>`).join("")}</ul>`; }

  function renderModules(){
    const host = $("modulesHost");
    host.innerHTML = "";

    const picks = selectedFocusKeys();
    if(!picks.length){
      host.innerHTML = `<div class="foot">Select one or more focus areas above to load the guiding questions, daily look-fors, and evidence validation prompts.</div>`;
      refreshMetricPicker();
      refreshCharts();
      return;
    }

    picks.forEach(key=>{
      const f = FOCUS.find(x=>x.key===key);
      if(!f) return;

      const wrap = document.createElement("div");
      wrap.className = "panel";
      wrap.style.marginBottom = "14px";
      wrap.classList.add(f.theme==="gold" ? "theme-gold" : "theme-gray");

      wrap.innerHTML = `
        <div class="panelHeader">
          <div>
            <h2>${f.title}</h2>
            <div class="hint">${f.tagline}</div>
          </div>
          <div class="chip"><span class="dot"></span><span>Daily vs Evidence</span></div>
        </div>

        <div class="panelBody">
          <div class="blocks">
            <div class="block ${f.theme==="gold" ? "gold" : "gray"} span-12">
              <div class="k">Component Map</div>
              <p class="q">Major components, indicators, daily observable practice, and evidence validation points.</p>

              <details open>
                <summary>
                  <span>Major Components + Key Indicators</span>
                  <span class="sumHint">architecture and signals</span>
                </summary>
                <div class="detailBody">
                  <div><b>Major Components</b>${listHTML(f.majorComponents)}</div>
                  <div style="margin-top:10px;"><b>Key Indicators</b>${listHTML(f.keyIndicators)}</div>
                </div>
              </details>

              <details>
                <summary>
                  <span>What Can Be Observed Daily</span>
                  <span class="sumHint">walkthrough look-fors</span>
                </summary>
                <div class="detailBody">
                  ${listHTML(f.observedDaily)}
                </div>
              </details>

              <details>
                <summary>
                  <span>What Can Be Validated Through Evidence</span>
                  <span class="sumHint">artifacts and proof</span>
                </summary>
                <div class="detailBody">
                  ${listHTML(f.validatedEvidence)}
                </div>
              </details>

              <details>
                <summary>
                  <span>Precision Push Question</span>
                  <span class="sumHint">where clarity matters</span>
                </summary>
                <div class="detailBody">
                  <b>${f.pushQuestion}</b>
                  <div class="muted" style="margin-top:6px;">Use this question to sharpen coaching notes and the next proof point.</div>
                </div>
              </details>
            </div>

            <div class="block ${f.theme==="gold" ? "gold" : "gray"} span-6">
              <div class="k">Weekly sub-area</div>
              <p class="q">Choose one sub-area so the week stays focused.</p>
              <label for="sub_${safeId(key)}">Sub-area</label>
              <select id="sub_${safeId(key)}">
                ${f.subareas.map(sa=>`<option value="${sa.key}">${sa.key}</option>`).join("")}
              </select>
              <div class="foot" id="subDesc_${safeId(key)}"></div>
            </div>

            <div class="block span-6">
              <div class="k">Module status</div>
              <p class="q">Truth first. Then improvement.</p>
              <label for="mstatus_${safeId(key)}">R/Y/G</label>
              <select id="mstatus_${safeId(key)}">
                <option value="Green">Green (On plan)</option>
                <option value="Yellow">Yellow (Uneven)</option>
                <option value="Red">Red (Off plan)</option>
              </select>
              <div>${tagHTML("Green")} ${tagHTML("Yellow")} ${tagHTML("Red")}</div>
            </div>

            <div class="block span-6">
              <div class="k">What changed since last week?</div>
              <p class="q">Name what moved. If nothing moved, say that clearly.</p>
              <textarea id="mchanged_${safeId(key)}" class="small" placeholder="Numbers or observable differences. What improved? What regressed?"></textarea>
            </div>

            <div class="block span-6">
              <div class="k">Main barrier (root cause, 1 sentence)</div>
              <p class="q">What is the real constraint holding this back?</p>
              <textarea id="mbarrier_${safeId(key)}" class="small" placeholder="Example: CFUs are inconsistent, so teams cannot respond fast enough."></textarea>
            </div>

            <div class="block span-6">
              <div class="k">Help needed</div>
              <p class="q">Who needs to remove the barrier, and what do you need?</p>
              <textarea id="mhelp_${safeId(key)}" class="small" placeholder="Curriculum, Student Services, HR, Transportation, Tech, Ops, etc."></textarea>
            </div>

            <div class="block ${f.theme==="gold" ? "gold" : "gray"} span-12">
              <div class="k">Walkthrough look-fors (checkbox)</div>
              <p class="q">Use this as your daily observable scan. Check only what you actually saw.</p>
              <div class="checks" id="checks_${safeId(key)}"></div>
            </div>

            <div class="block ${f.theme==="gold" ? "gold" : "gray"} span-12">
              <div class="k">Ratings (1–4)</div>
              <p class="q">Use the same scale every week. The goal is trend visibility and coaching clarity.</p>
              <div id="ratings_${safeId(key)}"></div>
            </div>

            <div class="block span-6">
              <div class="k">Numeric signals (optional)</div>
              <p class="q">Only track what you actually track. Leave blank if unknown.</p>
              <div id="signals_${safeId(key)}"></div>
            </div>

            <div class="block span-6">
              <div class="k">Evidence and artifacts</div>
              <p class="q"><b>Evidence rule:</b> ${f.evidenceRule}</p>
              <label for="mevidence_${safeId(key)}">Evidence link(s)</label>
              <input type="text" id="mevidence_${safeId(key)}" placeholder="Paste link to folder, doc, photo, student work, or dashboard"/>
              <div style="height:10px"></div>
              <label for="mfile_${safeId(key)}">Upload (file name stored)</label>
              <input type="file" id="mfile_${safeId(key)}"/>
              <div class="foot" id="mfileNote_${safeId(key)}">No file selected.</div>
            </div>

            <div class="block span-6">
              <div class="k">Module wins</div>
              <p class="q">What worked that should be replicated?</p>
              <textarea id="mglows_${safeId(key)}" class="small"></textarea>
            </div>

            <div class="block span-6">
              <div class="k">Module gaps</div>
              <p class="q">What needs tightening next week?</p>
              <textarea id="mgrows_${safeId(key)}" class="small"></textarea>
            </div>
          </div>
        </div>
      `;

      host.appendChild(wrap);

      // sub-area description
      const subSel = document.getElementById(`sub_${safeId(key)}`);
      const subDesc = document.getElementById(`subDesc_${safeId(key)}`);
      function updateDesc(){
        const v = subSel.value;
        const sa = f.subareas.find(x=>x.key===v);
        subDesc.textContent = sa ? sa.desc : "";
      }
      subSel.addEventListener("change", updateDesc);
      updateDesc();

      // look-fors
      const checksHost = document.getElementById(`checks_${safeId(key)}`);
      f.lookFors.forEach(lf=>{
        const c = document.createElement("div");
        c.className = "check";
        c.innerHTML = `
          <input type="checkbox" id="lf_${safeId(key)}_${lf.id}">
          <div>
            <b>${lf.title}</b>
            <small>${lf.desc}</small>
          </div>
        `;
        checksHost.appendChild(c);
      });

      // ratings
      const ratingsHost = document.getElementById(`ratings_${safeId(key)}`);
      f.ratings.forEach(r=>{
        const row = document.createElement("div");
        row.style.marginBottom = "10px";
        row.innerHTML = `
          <label>${r.label}</label>
          <div class="ratingRow" data-focus="${key}" data-rating="${r.key}" data-value=""></div>
          <div class="foot">${r.hint}</div>
        `;
        ratingsHost.appendChild(row);

        const group = row.querySelector(".ratingRow");
        [1,2,3,4].forEach(n=>{
          const b = document.createElement("div");
          b.className = "rateBtn";
          b.textContent = n;
          b.addEventListener("click", ()=>{
            group.querySelectorAll(".rateBtn").forEach(x=>x.classList.remove("active"));
            b.classList.add("active");
            group.setAttribute("data-value", String(n));
          });
          group.appendChild(b);
        });
      });

      // signals
      const sigHost = document.getElementById(`signals_${safeId(key)}`);
      f.signals.forEach(s=>{
        const div = document.createElement("div");
        div.style.marginBottom = "10px";
        div.innerHTML = `
          <label for="sig_${safeId(key)}_${s.key}">${s.label}</label>
          <input type="number" id="sig_${safeId(key)}_${s.key}" placeholder="(optional)"/>
        `;
        sigHost.appendChild(div);
      });

      // file note
      const fileInput = document.getElementById(`mfile_${safeId(key)}`);
      fileInput.addEventListener("change", ()=>{
        const f0 = fileInput.files && fileInput.files[0];
        document.getElementById(`mfileNote_${safeId(key)}`).textContent = f0 ? `Selected: ${f0.name}` : "No file selected.";
      });
    });

    refreshMetricPicker();
    refreshCharts();
  }

  // ---------------- COLLECT / SAVE ----------------
  function collectModules(){
    const picks = selectedFocusKeys();
    const out = {};
    picks.forEach(key=>{
      const f = FOCUS.find(x=>x.key===key);
      const mod = {
        subarea: document.getElementById(`sub_${safeId(key)}`)?.value || "",
        status: document.getElementById(`mstatus_${safeId(key)}`)?.value || "Green",
        changed: (document.getElementById(`mchanged_${safeId(key)}`)?.value || "").trim(),
        barrier: (document.getElementById(`mbarrier_${safeId(key)}`)?.value || "").trim(),
        help: (document.getElementById(`mhelp_${safeId(key)}`)?.value || "").trim(),
        evidenceLink: (document.getElementById(`mevidence_${safeId(key)}`)?.value || "").trim(),
        attachment: null,
        lookFors: {},
        ratings: {},
        signals: {},
        wins: (document.getElementById(`mglows_${safeId(key)}`)?.value || "").trim(),
        gaps: (document.getElementById(`mgrows_${safeId(key)}`)?.value || "").trim()
      };

      f.lookFors.forEach(lf=>{
        const el = document.getElementById(`lf_${safeId(key)}_${lf.id}`);
        mod.lookFors[lf.id] = el ? !!el.checked : false;
      });

      document.querySelectorAll(`.ratingRow[data-focus="${CSS.escape(key)}"]`).forEach(group=>{
        const rKey = group.getAttribute("data-rating");
        const v = group.getAttribute("data-value");
        mod.ratings[rKey] = v ? Number(v) : "";
      });

      f.signals.forEach(s=>{
        const el = document.getElementById(`sig_${safeId(key)}_${s.key}`);
        mod.signals[s.key] = (el && el.value !== "") ? Number(el.value) : "";
      });

      const fileInput = document.getElementById(`mfile_${safeId(key)}`);
      const file = fileInput && fileInput.files && fileInput.files[0];
      mod.attachment = file ? { name:file.name, type:file.type, size:file.size } : null;

      out[key] = mod;
    });
    return out;
  }

  function collectEntry(){
    return {
      id: $("saveBtn").getAttribute("data-editing") || newId(),
      date: $("entryDate").value,
      entryType: $("entryType").value,
      school: $("school").value,
      who: $("who").value,

      overallStatus: $("overallStatus").value,
      weekTheme: ($("weekTheme").value || "").trim(),
      whatChanged: ($("whatChanged").value || "").trim(),
      topIssues: ($("topIssues").value || "").trim(),
      helpNeeded: ($("helpNeeded").value || "").trim(),
      owner: ($("owner").value || "").trim(),
      dueDate: $("dueDate").value,

      focusKeys: selectedFocusKeys(),
      generalGlows: ($("generalGlows").value || "").trim(),
      generalGrows: ($("generalGrows").value || "").trim(),

      modules: collectModules(),

      nextMoves: ($("nextMoves").value || "").trim(),
      proofNextWeek: ($("proofNextWeek").value || "").trim(),

      updatedAt: new Date().toISOString()
    };
  }

  function resetForm(){
    $("entryDate").value = todayISO();
    $("dueDate").value = todayISO();
    $("entryType").value = "Weekly Check-In";
    $("school").value = "";
    $("who").value = "Principal";

    $("overallStatus").value = "Green";
    $("weekTheme").value = "";
    $("whatChanged").value = "";
    $("topIssues").value = "";
    $("helpNeeded").value = "";
    $("owner").value = "";

    $("generalGlows").value = "";
    $("generalGrows").value = "";

    $("nextMoves").value = "";
    $("proofNextWeek").value = "";

    FOCUS.forEach(f=>{
      const cb = document.getElementById(`focus_${safeId(f.key)}`);
      if(cb) cb.checked = false;
    });

    $("modulesHost").innerHTML = `<div class="foot">Select focus areas to load modules.</div>`;
    $("saveBtn").removeAttribute("data-editing");
    $("saveBtn").textContent = "Save Entry";
    refreshAll();
  }

  function loadEntryToForm(id){
    const e = entries.find(x=>x.id===id);
    if(!e) return;

    $("entryDate").value = e.date || todayISO();
    $("entryType").value = e.entryType || "Weekly Check-In";
    $("school").value = e.school || "";
    $("who").value = e.who || "Principal";

    $("overallStatus").value = e.overallStatus || "Green";
    $("weekTheme").value = e.weekTheme || "";
    $("whatChanged").value = e.whatChanged || "";
    $("topIssues").value = e.topIssues || "";
    $("helpNeeded").value = e.helpNeeded || "";
    $("owner").value = e.owner || "";
    $("dueDate").value = e.dueDate || todayISO();

    $("generalGlows").value = e.generalGlows || "";
    $("generalGrows").value = e.generalGrows || "";

    $("nextMoves").value = e.nextMoves || "";
    $("proofNextWeek").value = e.proofNextWeek || "";

    // focus checks
    FOCUS.forEach(f=>{
      const cb = document.getElementById(`focus_${safeId(f.key)}`);
      if(cb) cb.checked = (e.focusKeys || []).includes(f.key);
    });

    renderModules();

    // fill modules
    (e.focusKeys || []).forEach(key=>{
      const f = FOCUS.find(x=>x.key===key);
      const m = e.modules && e.modules[key];
      if(!f || !m) return;

      const sub = document.getElementById(`sub_${safeId(key)}`); if(sub) sub.value = m.subarea || sub.value;
      const ms  = document.getElementById(`mstatus_${safeId(key)}`); if(ms) ms.value = m.status || "Green";
      const mc  = document.getElementById(`mchanged_${safeId(key)}`); if(mc) mc.value = m.changed || "";
      const mb  = document.getElementById(`mbarrier_${safeId(key)}`); if(mb) mb.value = m.barrier || "";
      const mh  = document.getElementById(`mhelp_${safeId(key)}`); if(mh) mh.value = m.help || "";
      const ev  = document.getElementById(`mevidence_${safeId(key)}`); if(ev) ev.value = m.evidenceLink || "";
      const w   = document.getElementById(`mglows_${safeId(key)}`); if(w) w.value = m.wins || "";
      const g   = document.getElementById(`mgrows_${safeId(key)}`); if(g) g.value = m.gaps || "";

      // lookFors
      f.lookFors.forEach(lf=>{
        const el = document.getElementById(`lf_${safeId(key)}_${lf.id}`);
        if(el) el.checked = !!(m.lookFors && m.lookFors[lf.id]);
      });

      // ratings
      document.querySelectorAll(`.ratingRow[data-focus="${CSS.escape(key)}"]`).forEach(group=>{
        const rKey = group.getAttribute("data-rating");
        const v = m.ratings ? m.ratings[rKey] : "";
        group.setAttribute("data-value", v ? String(v) : "");
        group.querySelectorAll(".rateBtn").forEach(btn=>{
          btn.classList.toggle("active", btn.textContent === String(v));
        });
      });

      // signals
      f.signals.forEach(s=>{
        const el = document.getElementById(`sig_${safeId(key)}_${s.key}`);
        if(el) el.value = (m.signals && m.signals[s.key] !== "" && m.signals[s.key] !== undefined) ? m.signals[s.key] : "";
      });

      // attachment note only
      const note = document.getElementById(`mfileNote_${safeId(key)}`);
      if(note) note.textContent = m.attachment ? `Previously noted: ${m.attachment.name}` : "No file selected.";
      const fileInput = document.getElementById(`mfile_${safeId(key)}`);
      if(fileInput) fileInput.value = "";
    });

    $("saveBtn").setAttribute("data-editing", e.id);
    $("saveBtn").textContent = "Update Entry";

    refreshAll();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // ---------------- DASHBOARD ----------------
  function refreshFilterOptions(){
    const sel = $("filterSchool");
    const current = sel.value;
    const schools = Array.from(new Set(entries.map(e=>e.school))).filter(Boolean);
    sel.innerHTML = `<option value="ALL">All Schools</option>` + schools.map(s=>`<option>${s}</option>`).join("");
    if([...sel.options].some(o=>o.value===current)) sel.value = current;
  }

  function filteredEntries(){
    const fs = $("filterSchool").value;
    if(fs==="ALL") return entries.slice();
    return entries.filter(e=>e.school===fs);
  }

  function refreshTable(){
    const tbody = $("entriesTable").querySelector("tbody");
    tbody.innerHTML = "";
    const list = filteredEntries().slice().sort((a,b)=> (b.date||"").localeCompare(a.date||"")).slice(0, 20);

    list.forEach(e=>{
      const tr = document.createElement("tr");
      tr.className = "clickRow";
      tr.innerHTML = `
        <td>${e.date || ""}</td>
        <td><b>${e.school || ""}</b><div class="muted" style="font-size:11px">${e.entryType || ""}</div></td>
        <td>${tagHTML(e.overallStatus || "Green")}</td>
        <td class="muted">${(e.focusKeys||[]).join(", ")}</td>
      `;
      tr.addEventListener("click", ()=> loadEntryToForm(e.id));
      tbody.appendChild(tr);
    });

    $("entryCount").textContent = String(filteredEntries().length);
    $("entryCountChip").textContent = `${entries.length} entries`;
  }

  function refreshMetricPicker(){
    const map = new Map();
    FOCUS.forEach(f=>{
      f.signals.forEach(s=> map.set(s.key, s.label));
    });
    const sel = $("metricPick");
    const current = sel.value;
    sel.innerHTML = Array.from(map.entries()).map(([k,label])=>`<option value="${k}">${label}</option>`).join("");
    if([...sel.options].some(o=>o.value===current)) sel.value = current;
  }

  function refreshCharts(){
    const data = filteredEntries().slice().sort((a,b)=> (a.date||"").localeCompare(b.date||""));
    const labels = data.map(e=>e.date);

    // Overall status numeric
    const statusVals = data.map(e=>{
      const s = e.overallStatus || "Green";
      if(s==="Green") return 3;
      if(s==="Yellow") return 2;
      return 1;
    });

    const ctx1 = $("statusChart").getContext("2d");
    if(statusChart) statusChart.destroy();
    statusChart = new Chart(ctx1, {
      type:"line",
      data:{ labels, datasets:[{ label:"Overall Status (Red=1, Yellow=2, Green=3)", data: statusVals, tension:0.25 }] },
      options:{ responsive:true, plugins:{ legend:{display:true} }, scales:{ y:{ min:1, max:3, ticks:{ stepSize:1 } } } }
    });

    // Numeric signal (average across selected modules if present)
    const metricKey = $("metricPick").value;
    const metricVals = data.map(e=>{
      const keys = e.focusKeys || [];
      const found = [];
      keys.forEach(k=>{
        const mod = e.modules && e.modules[k];
        const v = mod && mod.signals ? mod.signals[metricKey] : "";
        if(v !== "" && v !== undefined && v !== null) found.push(Number(v));
      });
      if(!found.length) return null;
      return Number((found.reduce((a,b)=>a+b,0)/found.length).toFixed(2));
    });

    const ctx2 = $("metricChart").getContext("2d");
    if(metricChart) metricChart.destroy();
    metricChart = new Chart(ctx2, {
      type:"line",
      data:{ labels, datasets:[{ label:`Signal: ${metricKey}`, data: metricVals, tension:0.25 }] },
      options:{ responsive:true, plugins:{ legend:{display:true} }, scales:{ y:{ beginAtZero:true } } }
    });
  }

  function refreshAll(){
    refreshFilterOptions();
    refreshMetricPicker();
    refreshTable();
    refreshCharts();
  }

  // ---------------- EXPORT ----------------
  function safeCSV(s){ return String(s).replace(/\r?\n/g, " ").trim(); }
  function csvCell(value){
    const v = value === null || value === undefined ? "" : String(value);
    if(/[",\n]/.test(v)) return `"${v.replace(/"/g,'""')}"`;
    return v;
  }
  function downloadBlob(blob, filename){
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
  }

  function exportJSON(){
    const blob = new Blob([JSON.stringify(entries, null, 2)], { type:"application/json" });
    downloadBlob(blob, "vibrant-accountability-entries.json");
  }
  function exportCSV(){
    const headers = [
      "id","date","school","entryType","who","overallStatus","weekTheme","whatChanged",
      "topIssues","helpNeeded","owner","dueDate","focusKeys","generalGlows","generalGrows",
      "nextMoves","proofNextWeek","updatedAt","focusStatusSummary"
    ];
    const rows = entries.map(e=>{
      const focusKeys = (e.focusKeys||[]).join("|");
      const summary = (e.focusKeys||[]).map(k=>{
        const m = e.modules && e.modules[k];
        const st = m ? (m.status||"") : "";
        const sub = m ? (m.subarea||"") : "";
        return `${k}:${st}:${sub}`;
      }).join("||");

      return [
        e.id, e.date, e.school, e.entryType, e.who,
        e.overallStatus||"", safeCSV(e.weekTheme||""), safeCSV(e.whatChanged||""),
        safeCSV(e.topIssues||""), safeCSV(e.helpNeeded||""), safeCSV(e.owner||""), e.dueDate||"",
        safeCSV(focusKeys), safeCSV(e.generalGlows||""), safeCSV(e.generalGrows||""),
        safeCSV(e.nextMoves||""), safeCSV(e.proofNextWeek||""), e.updatedAt||"",
        safeCSV(summary)
      ];
    });

    const csv = [headers.join(","), ...rows.map(r=>r.map(csvCell).join(","))].join("\n");
    const blob = new Blob([csv], { type:"text/csv;charset=utf-8" });
    downloadBlob(blob, "vibrant-accountability-entries.csv");
  }

  // ---------------- MONDAY SUMMARY ----------------
  function buildMondaySummary(e){
    const lines = [];
    lines.push(`VIBRANT ACCOUNTABILITY MONDAY SUMMARY`);
    lines.push(`Date: ${e.date || ""} | School: ${e.school || ""} | Type: ${e.entryType || ""}`);
    lines.push(`Overall Status: ${e.overallStatus || ""}`);
    if(e.weekTheme) lines.push(`Week Theme: ${e.weekTheme}`);
    lines.push(``);
    lines.push(`What changed: ${e.whatChanged || "(not entered)"}`);
    lines.push(`Top issue: ${e.topIssues || "(not entered)"}`);
    lines.push(`Help needed: ${e.helpNeeded || "(not entered)"}`);
    lines.push(`Owner / Due: ${e.owner || "(not entered)"} / ${e.dueDate || "(not entered)"}`);
    lines.push(``);
    lines.push(`Focus areas: ${(e.focusKeys||[]).join(", ")}`);
    (e.focusKeys||[]).forEach(k=>{
      const m = e.modules && e.modules[k];
      if(!m) return;
      lines.push(`- ${k} | Status: ${m.status} | Sub-area: ${m.subarea}`);
      if(m.changed) lines.push(`  Changed: ${m.changed}`);
      if(m.barrier) lines.push(`  Barrier: ${m.barrier}`);
      if(m.help) lines.push(`  Help: ${m.help}`);
      if(m.evidenceLink) lines.push(`  Evidence: ${m.evidenceLink}`);
    });
    lines.push(``);
    lines.push(`Wins: ${e.generalGlows || "(not entered)"}`);
    lines.push(`Gaps: ${e.generalGrows || "(not entered)"}`);
    lines.push(``);
    lines.push(`Next Moves: ${e.nextMoves || "(not entered)"}`);
    lines.push(`Proof next Monday: ${e.proofNextWeek || "(not entered)"}`);
    return lines.join("\n");
  }

  // ---------------- EVENTS ----------------
  $("saveBtn").addEventListener("click", ()=>{
    const e = collectEntry();
    if(!e.date){ alert("Add a date."); return; }
    if(!e.school){ alert("Select a school."); return; }
    if(!e.focusKeys.length){ alert("Select at least one focus area."); return; }

    const idx = entries.findIndex(x=>x.id===e.id);
    if(idx>=0) entries[idx] = e;
    else entries.push(e);

    saveEntries();
    refreshAll();
    resetForm();
  });

  $("summaryBtn").addEventListener("click", ()=>{
    const e = collectEntry();
    if(!e.date || !e.school || !e.focusKeys.length){
      alert("Fill date, school, and at least one focus area, then click Monday Summary again.");
      return;
    }
    const summary = buildMondaySummary(e);
    const w = window.open("", "_blank");
    w.document.write(`<pre style="white-space:pre-wrap;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; padding:16px;">${summary.replace(/</g,"&lt;")}</pre>`);
    w.document.title = "Monday Summary";
  });

  $("exportJsonBtn").addEventListener("click", exportJSON);
  $("exportCsvBtn").addEventListener("click", exportCSV);

  $("clearBtn").addEventListener("click", ()=>{
    const ok = confirm("This will remove all saved entries from this browser. Continue?");
    if(!ok) return;
    entries = [];
    saveEntries();
    refreshAll();
    resetForm();
  });

  $("filterSchool").addEventListener("change", refreshAll);
  $("metricPick").addEventListener("change", refreshCharts);

  // ---------------- INIT ----------------
  (function init(){
    $("entryDate").value = todayISO();
    $("dueDate").value = todayISO();
    renderFocusTiles();
    loadEntries();
    refreshAll();
    $("modulesHost").innerHTML = `<div class="foot">Select focus areas to load modules.</div>`;
  })();
</script>
</body>
</html>
